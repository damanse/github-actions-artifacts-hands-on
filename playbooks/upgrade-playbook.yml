# upgrade-playbook.yml

- name: Upgrade host
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Simulate upgrade
      ansible.builtin.debug:
        msg: "Upgrading {{ target_host }}"

    - name: Generate pause time between 1 and 5 minutes
      ansible.builtin.set_fact:
        pause_minutes: "{{ 1 + (5 - 1) | random }}"

    - name: Pause completing the upgrade
      ansible.builtin.pause:
        # minutes: "{{ pause_minutes }}"
        seconds: "{{ pause_minutes }}"

    - name: Generate random number between 1 and 3
      ansible.builtin.shell: echo $(( ( RANDOM % 3 ) + 1 ))
      register: random_result

    - name: Show the generated number
      ansible.builtin.debug:
        msg: "Generated number: {{ random_result.stdout }}"

    - name: Simulate failure if number is 1
      ansible.builtin.fail:
        msg: "Host Upgrade has failed!"
      when: random_result.stdout == "1"

    - name: Simulate success
      ansible.builtin.debug:
        msg: "Host Upgrade has succeeded!"
      when: random_result.stdout != 1